var t={};class e{static STATUS={idle:"idle",playing:"playing",win:"win",lose:"lose"};constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.status=e.STATUS.idle,this.initialState=t,this.state=t.map(t=>[...t]),this.score=0}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=e.STATUS.playing,this.getRandomBlock(),this.getRandomBlock()}restart(){this.status=e.STATUS.idle,this.state=this.initialState.map(t=>[...t]),this.score=0}getRandomBlock(){let t=this.state.reduce((t,e,s)=>(e.forEach((e,i)=>{0===e&&t.push([s,i])}),t),[]);if(t.length>0){let[e,s]=t[Math.floor(Math.random()*t.length)];this.state[e][s]=.9>Math.random()?2:4}}moveLeft(){this.move(t=>t,(t,e)=>this.state[e]=t)}moveRight(){this.move(t=>t.reverse(),(t,e)=>this.state[e]=t.reverse())}moveUp(){this.status===e.STATUS.playing&&this.move((t,e)=>this.getColumn(e),(t,e)=>this.setColumn(t,e))}moveDown(){this.status===e.STATUS.playing&&this.move((t,e)=>this.getColumn(e).reverse(),(t,e)=>this.setColumn(t.reverse(),e))}move(t,s){if(this.status!==e.STATUS.playing)return;let i=!1;for(let e=0;e<4;e++){let a=t(this.state[e],e),[n]=this.combineAndShift(a);n.toString()!==a.toString()&&(i=!0),s(n,e)}i&&(this.getRandomBlock(),this.checkGameOverOrWin())}getColumn(t){return this.state.map(e=>e[t])}setColumn(t,e){t.forEach((t,s)=>{this.state[s][e]=t})}combineAndShift(t){let e=t.filter(t=>0!==t),s=!1;for(let t=0;t<e.length-1;t++)e[t]===e[t+1]&&(e[t]*=2,this.score+=e[t],e[t+1]=0,s=!0);for(e=e.filter(t=>0!==t);e.length<4;)e.push(0);return[e,s]}checkGameOverOrWin(){if(this.state.flat().includes(2048)){this.status=e.STATUS.win;return}this.canMove()||(this.status=e.STATUS.lose)}canMove(){for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(0===this.state[t][e]||e<3&&this.state[t][e]===this.state[t][e+1]||t<3&&this.state[t][e]===this.state[t+1][e])return!0;return!1}}const s=new(t=e),i=document.querySelector(".start"),a=document.querySelector(".game-score"),n=document.querySelector(".game-field"),o=document.querySelector(".message-start"),r=document.querySelector(".message-lose"),l=document.querySelector(".message-win");function h(){n.innerHTML="",s.getState().forEach(t=>{let e=document.createElement("tr");t.forEach(t=>{let s=document.createElement("td");s.textContent=0!==t?t:"",s.className=`field-cell${t?` field-cell--${t}`:""}`,e.appendChild(s)}),n.appendChild(e)}),a.textContent=s.getScore(),function(){c();let e=s.getStatus();e===t.STATUS.win?l.classList.remove("hidden"):e===t.STATUS.lose&&r.classList.remove("hidden")}()}function c(){o.classList.add("hidden"),r.classList.add("hidden"),l.classList.add("hidden")}i.addEventListener("click",()=>{let t=i.classList.contains("start");s[t?"start":"restart"](),i.classList.toggle("start"),i.classList.toggle("restart"),i.textContent=t?"Restart":"Start",c(),h()}),document.addEventListener("keydown",t=>{let e={ArrowRight:"moveRight",ArrowLeft:"moveLeft",ArrowUp:"moveUp",ArrowDown:"moveDown"};e[t.key]&&(s[e[t.key]](),h())});let d=0,m=0;document.addEventListener("touchstart",t=>{d=t.touches[0].clientX,m=t.touches[0].clientY}),document.addEventListener("touchend",t=>{let e=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY,a=e-d,n=i-m;Math.abs(a)>Math.abs(n)?a>0?s.moveRight():s.moveLeft():n>0?s.moveDown():s.moveUp(),h()}),h();
//# sourceMappingURL=index.e6d02754.js.map
